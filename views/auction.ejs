<%- include('./partials/header.ejs') %>
<%- include('./partials/flash.ejs') %>
<main class="auction-page">
  <a href="#latestListingsTitle" class="skip-link">Skip to listings</a>
    <div class="container auction-page auction-container">
      <header class="auction-hero"> 
        <h1 class="auction-title">Auction Listings</h1>
        <p class="auction-subtitle">Create a listing and browse the latest items.</p>
      </header>
      <div class="auction-grid">
        <section class="auction-card" aria-labelledby="createListingTitle">
          <h2 class="auction-card-title" id="createListingTitle">Create Listing</h2>
          <form action="/auction" method="POST" class="auction-form" aria-labelledby="createListingTitle">
            <div class="auction-form-group">
              <label for="title">Title</label>
              <input id="title" type="text" name="title" placeholder="Enter item title" required aria-required="true" aria-invalid="false" autocomplete="off">
            </div>
            <div class="auction-form-group">
              <label for="description">Description</label>
              <textarea id="description" name="description" placeholder="Enter item description" rows="4" required aria-required="true" aria-invalid="false"></textarea>
            </div>
            <div class="auction-form-group">
              <label for="image">Image URL</label>
              <input id="image" type="url" name="image" placeholder="https://example.com/image.jpg" aria-describedby="imageHelp">
              <small id="imageHelp">Optional - Add a URL to an image of your sale</small>
            </div>
            <div class="auction-form-group">
              <label for="video">Video URL</label>
              <input id="video" type="url" name="video" placeholder="https://example.com/video.mp4" aria-describedby="videoHelp">
              <small id="videoHelp">Optional - Add a URL to a video of your sale</small>
            </div>
            <div class="auction-form-actions">
              <button type="submit" class="btn btn-primary">Create</button>
            </div>
          </form>
        </section>
        <section class="auction-card auction-card--list" aria-labelledby="latestListingsTitle">
          <div class="auction-list-header">
            <h2 class="auction-card-title" id="latestListingsTitle">Latest Listings</h2>
            <p class="auction-list-meta">
              <span aria-live="polite" aria-atomic="true">
                <%= (listings && listings.length) ? listings.length : 0 %> total
              </span>
            </p>
          </div>
          <% if (listings && listings.length > 0) { %>
            <ul class="auction-listings">
              <% listings.forEach(listing => { %>
                <li class="listing-card" id="listing-<%= listing.id %>">
                  <div class="listing-card-media">
                    <% if (listing.image) { %>
                      <img class="listing-card-image" src="<%= listing.image %>" alt="<%= listing.title %>" loading="lazy">
                    <% } else { %>
                      <div class="listing-card-placeholder" aria-hidden="true" role="presentation"></div>
                    <% } %>
                  </div>
                  <div class="listing-card-body">
                    <h3 class="listing-card-title"><%= listing.title %></h3>
                    <p class="listing-card-description"><%= listing.description %></p>
                    <% if (listing.user) { %>
                      <img src="<%= listing.user.image %>" alt="<%= listing.user.firstName %>'s profile photo" loading="lazy">
                      <p>Posted by: <%= listing.user.firstName %></p>
                  <% } %>
                  <% if (user && listing.user && listing.user._id.toString() === user.id) { %>
                    <form action="/auction/deleteListing/<%= listing._id %>?_method=DELETE" method="POST"> 
                        <button type="submit">Delete</button>
                    </form>
                <% } %>
                  </div>
                </li>
              <% }) %>
            </ul>
          <% } else { %>
            <div class="auction-empty" role="status" aria-live="polite">
              <h3 class="auction-empty-title">No listings yet</h3>
              <p class="auction-empty-text">Create your first listing using the form.</p>
            </div>
          <% } %>
        </section>
      </div>
  </div>
</main>
<script src="/js/main.js"></script>